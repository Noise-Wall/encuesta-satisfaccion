import{g as v}from"./get-f30a68b2.js";import{i as P}from"./insert-9269597b.js";import{u as q}from"./update-93894906.js";import{h as D,u as F,r as l,d as M,q as H,o as n,c as o,a as e,F as u,e as $,j as z,s as A,k as G,w as J,t as E,f as R,l as m,p as K,b as Q}from"./index-2e079f12.js";import{p as f}from"./popup-cfc4d190.js";import{_ as U}from"./_plugin-vue_export-helper-c27b6911.js";import"./token-3b81b8e9.js";const c=_=>(K("data-v-ed736457"),_=_(),Q(),_),W=c(()=>e("div",{class:"cargando"},null,-1)),X=c(()=>e("p",null,"Cargando...",-1)),Y={key:1},Z=c(()=>e("div",{class:"info"},[e("p",null,"Los criterios de evaluación son los siguientes:"),e("p",null," Excelente (10 puntos), Bueno (8 puntos), Regular (6 puntos), Malo (4 puntos) y Pésimo (2 puntos); se suman los resultados y se saca un promedio. ")],-1)),ee={class:"panel-tabla"},te={key:0,class:"item-encuesta item-encuesta-head"},ae={key:1,class:"item-encuesta item-encuesta-head"},ne=["value"],oe=["name"],se=["name"],re=["name"],le=["name"],ue=["name"],ce=c(()=>e("div",{class:"item-encuesta item-encuesta-head"}," Comentarios (Opcional) ",-1)),ie=c(()=>e("fieldset",null,[e("legend",null," Si desea realizar alguna observación sobre el servicio que no hayamos contemplado en la encuesta, compártalo a continuación: "),e("textarea",{name:"comentarios",rows:"4",placeholder:"Comparta su opinión (opcional)...",id:"comentarios"})],-1)),de=c(()=>e("h1",null,"Terminar encuesta",-1)),pe=[de],me=c(()=>e("h1",null,"Clic de nuevo para confirmar",-1)),_e=[me],ge=c(()=>e("button",{class:"boton"},"Regresar",-1)),he={__name:"EncuestaView",setup(_){const g=D(),y=F(),k=l(!1),w=l(!0),T=l(!1);M(()=>{setTimeout(()=>k.value=!0,3e3),L().then(()=>{w.value||(console.error("La encuesta no existe"),y.push("/encuesta/error"))}),V().then(()=>{T.value&&(console.error("La encuesta ya ha sido contestada"),y.push("/encuesta/error"))})});const d=l({}),b=l({}),C=l(0),I=l(0);let p=l(!1);async function L(){await v.getTabla(`/encuestas/${g.params.id}`).then(t=>{w.value=t.Encuesta.length>0}).catch(t=>console.error(t))}async function V(){await v.getTabla(`/respuestas/group/${g.params.id}`).then(t=>{T.value=t.Respuesta.length>0}).catch(t=>console.error(t))}async function B(){await v.getTabla("/preguntas/enabled").then(t=>{d.value=t.Pregunta,C.value=Object.values(d.value).length}).catch(t=>console.log(t))}async function S(){await v.getTabla("/categorias").then(t=>{b.value=t.Categoria,I.value=Object.values(b.value).length}).catch(t=>console.log(t))}function j(){p.value=!1;let t=[];return document.querySelectorAll("form").forEach(i=>{let r=Object.fromEntries(new FormData(i).entries()),s=Object.values(r)[1]||null;if(!s)return[];t.push({idPregunta:r.idPregunta,valor:s,idEncuesta:g.params.id})}),t}async function x(){const t=document.getElementById("comentarios").value;t!==""&&await q.updateTabla(`/encuestas/update/${g.params.id}`,{comentarios:t}).then(a=>console.log(a)).catch(a=>{console.log(a),f.createPopup("Hubo un error al subir la información. Intente de nuevo.")})}async function N(){const t=j();if(t.length<1){f.createPopup("Debe llenar todos los campos.");return}await x(),t.forEach(async a=>{await P.insertTabla("/respuestas",a).then(i=>console.log(i)).catch(i=>{console.log(i),f.createPopup("Hubo un error al subir la información. Intente de nuevo.")})}),f.createPopup("Encuesta contestada exitosamente.",a=>O(a),"terminar")}const O=t=>{y.push("/"),t.target.parentElement.parentElement.remove()};return B(),S(),(t,a)=>{const i=H("router-link");return n(),o(u,null,[e("section",null,[C.value<1&&!k.value?(n(),o(u,{key:0},[W,X],64)):C.value<1?(n(),o("p",Y,"Lo sentimos. No se han encontrado preguntas.")):(n(),o(u,{key:2},[Z,e("div",ee,[(n(!0),o(u,null,$(d.value,(r,s)=>(n(),o(u,{key:s},[(n(!0),o(u,null,$(b.value,h=>(n(),o(u,{key:h.idCategoria},[h.idCategoria===r.idCategoria?(n(),o(u,{key:0},[s===0?(n(),o("div",te,E(h.contenidoCategoria),1)):d.value[s].idCategoria!==d.value[s-1].idCategoria?(n(),o("div",ae,E(h.contenidoCategoria),1)):R("",!0)],64)):R("",!0)],64))),128)),e("fieldset",null,[e("legend",null,E(r.contenidoPregunta),1),e("form",null,[e("input",{type:"hidden",name:"idPregunta",value:r.idPregunta},null,8,ne),e("span",null,[e("input",{type:"radio",value:"10",name:`valor${s}`},null,8,oe),m("Excelente")]),e("span",null,[e("input",{type:"radio",value:"8",name:`valor${s}`},null,8,se),m("Bueno")]),e("span",null,[e("input",{type:"radio",value:"6",name:`valor${s}`},null,8,re),m("Regular")]),e("span",null,[e("input",{type:"radio",value:"4",name:`valor${s}`},null,8,le),m("Malo")]),e("span",null,[e("input",{type:"radio",value:"2",name:`valor${s}`},null,8,ue),m("Pésimo")])])])],64))),128)),ce,ie]),z(p)?(n(),o("button",{key:1,class:"boton terminar",onClick:a[1]||(a[1]=r=>N())},_e)):(n(),o("button",{key:0,class:"boton terminar",onClick:a[0]||(a[0]=r=>A(p)?p.value=!0:p=!0)},pe))],64))]),e("section",null,[G(i,{to:"/"},{default:J(()=>[ge]),_:1})])],64)}}},we=U(he,[["__scopeId","data-v-ed736457"]]);export{we as default};
